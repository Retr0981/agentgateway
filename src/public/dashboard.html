<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AgentTrust Dashboard â€” Real-Time Agent Monitoring</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --bg: #0f1117;
      --bg-subtle: #141722;
      --bg-card: #1a1d27;
      --bg-card-hover: #22263a;
      --bg-glass: rgba(26, 29, 39, 0.7);
      --bg-glass-border: rgba(255, 255, 255, 0.06);
      --border: #2a2f3e;
      --text: #e2e8f0;
      --text-dim: #8892a4;
      --primary: #3b82f6;
      --primary-glow: rgba(59, 130, 246, 0.15);
      --success: #10b981;
      --success-bg: rgba(16, 185, 129, 0.12);
      --danger: #ef4444;
      --danger-bg: rgba(239, 68, 68, 0.12);
      --warning: #f59e0b;
      --warning-bg: rgba(245, 158, 11, 0.12);
      --purple: #8b5cf6;
      --purple-bg: rgba(139, 92, 246, 0.12);
      --glow-primary: rgba(59, 130, 246, 0.25);
      --glow-success: rgba(16, 185, 129, 0.25);
      --glow-danger: rgba(239, 68, 68, 0.25);
      --glow-warning: rgba(245, 158, 11, 0.25);
      --glow-purple: rgba(139, 92, 246, 0.25);
      --gradient-primary: linear-gradient(135deg, #3b82f6, #6366f1);
      --gradient-success: linear-gradient(135deg, #10b981, #059669);
      --gradient-danger: linear-gradient(135deg, #ef4444, #dc2626);
      --gradient-warning: linear-gradient(135deg, #f59e0b, #d97706);
      --gradient-purple: linear-gradient(135deg, #8b5cf6, #7c3aed);
      --shadow-card: 0 4px 24px rgba(0, 0, 0, 0.12);
      --shadow-card-hover: 0 8px 32px rgba(0, 0, 0, 0.2);
      --shadow-glow: 0 0 20px rgba(59, 130, 246, 0.15);
      --transition-base: 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      --radius-lg: 14px;
      --radius-md: 10px;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'Segoe UI', sans-serif;
      background: var(--bg);
      background-image:
        radial-gradient(ellipse at 20% 0%, rgba(59, 130, 246, 0.06) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 100%, rgba(139, 92, 246, 0.04) 0%, transparent 50%);
      color: var(--text);
      line-height: 1.5;
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: optimizeLegibility;
    }

    /* --- Top Bar --- */
    .topbar {
      background: rgba(26, 29, 39, 0.8);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border-bottom: 1px solid var(--bg-glass-border);
      padding: 14px 32px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 1px 12px rgba(0, 0, 0, 0.2);
    }

    .topbar-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .topbar-logo {
      font-size: 20px;
      font-weight: 700;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-decoration: none;
      letter-spacing: -0.3px;
    }

    .topbar-badge {
      font-size: 11px;
      padding: 3px 10px;
      background: rgba(59, 130, 246, 0.1);
      color: var(--primary);
      border: 1px solid rgba(59, 130, 246, 0.2);
      border-radius: 12px;
      font-weight: 600;
      letter-spacing: 0.3px;
    }

    .topbar-right {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .live-indicator {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      color: var(--success);
      font-weight: 500;
    }

    .live-dot {
      width: 8px;
      height: 8px;
      background: var(--success);
      border-radius: 50%;
      animation: pulse 2s infinite;
      box-shadow: 0 0 8px var(--glow-success), 0 0 2px var(--success);
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.4; }
    }

    .topbar-link {
      color: var(--text-dim);
      text-decoration: none;
      font-size: 13px;
      transition: color var(--transition-base);
      position: relative;
    }

    .topbar-link::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 0;
      height: 1.5px;
      background: var(--primary);
      transition: width var(--transition-base);
    }

    .topbar-link:hover { color: var(--text); }
    .topbar-link:hover::after { width: 100%; }

    /* --- Layout --- */
    .dashboard {
      padding: 24px 32px;
      max-width: 1600px;
      margin: 0 auto;
    }

    .dashboard-header {
      margin-bottom: 28px;
    }

    .dashboard-header h1 {
      font-size: 26px;
      font-weight: 800;
      letter-spacing: -0.5px;
      background: linear-gradient(135deg, var(--text) 0%, var(--text-dim) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .dashboard-header p {
      color: var(--text-dim);
      font-size: 14px;
      margin-top: 6px;
      letter-spacing: 0.1px;
      line-height: 1.6;
    }

    /* --- Stat Cards --- */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 16px;
      margin-bottom: 28px;
    }

    .stat-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 22px;
      transition: all var(--transition-base);
      position: relative;
      overflow: hidden;
      box-shadow: var(--shadow-card);
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      opacity: 0.7;
      transition: opacity var(--transition-base);
    }

    .stat-card:nth-child(1)::before { background: var(--gradient-primary); }
    .stat-card:nth-child(2)::before { background: var(--gradient-success); }
    .stat-card:nth-child(3)::before { background: var(--gradient-warning); }
    .stat-card:nth-child(4)::before { background: var(--gradient-purple); }
    .stat-card:nth-child(5)::before { background: var(--gradient-primary); }

    .stat-card:hover {
      border-color: rgba(59, 130, 246, 0.3);
      transform: translateY(-2px);
      box-shadow: var(--shadow-card-hover), var(--shadow-glow);
    }

    .stat-card:hover::before {
      opacity: 1;
    }

    .stat-label {
      font-size: 11px;
      color: var(--text-dim);
      text-transform: uppercase;
      letter-spacing: 0.8px;
      margin-bottom: 10px;
      font-weight: 500;
    }

    .stat-value {
      font-size: 34px;
      font-weight: 800;
      line-height: 1;
      letter-spacing: -0.5px;
      transition: color var(--transition-base);
    }

    .stat-value.primary { color: var(--primary); }
    .stat-value.success { color: var(--success); }
    .stat-value.danger { color: var(--danger); }
    .stat-value.warning { color: var(--warning); }
    .stat-value.purple { color: var(--purple); }

    .stat-sub {
      font-size: 12px;
      color: var(--text-dim);
      margin-top: 6px;
    }

    /* --- Grid Layout --- */
    .main-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      margin-bottom: 24px;
    }

    .full-width {
      grid-column: 1 / -1;
    }

    /* --- Cards --- */
    .card {
      background: var(--bg-glass);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      border: 1px solid var(--bg-glass-border);
      border-radius: var(--radius-lg);
      overflow: hidden;
      box-shadow: var(--shadow-card);
      transition: box-shadow var(--transition-base), border-color var(--transition-base);
    }

    .card:hover {
      border-color: rgba(255, 255, 255, 0.1);
      box-shadow: var(--shadow-card-hover);
    }

    .card-header {
      padding: 16px 20px;
      border-bottom: 1px solid var(--bg-glass-border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(255, 255, 255, 0.02);
    }

    .card-title {
      font-size: 13px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      color: var(--text);
    }

    .card-body {
      padding: 20px;
    }

    /* --- Agent Table --- */
    .agent-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
    }

    .agent-table th {
      text-align: left;
      padding: 12px 14px;
      font-size: 10px;
      color: var(--text-dim);
      text-transform: uppercase;
      letter-spacing: 0.8px;
      border-bottom: 1px solid var(--border);
      font-weight: 600;
      background: rgba(255, 255, 255, 0.02);
    }

    .agent-table td {
      padding: 14px;
      font-size: 13px;
      border-bottom: 1px solid rgba(42, 47, 62, 0.5);
      transition: background var(--transition-base);
    }

    .agent-table tr:last-child td {
      border-bottom: none;
    }

    .agent-table tbody tr:nth-child(even) td {
      background: rgba(255, 255, 255, 0.015);
    }

    .agent-table tbody tr:hover td {
      background: rgba(59, 130, 246, 0.05);
    }

    /* --- Score Badge --- */
    .score-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 12px;
      border-radius: 20px;
      font-weight: 700;
      font-size: 13px;
      letter-spacing: 0.3px;
    }

    .score-high {
      background: var(--success-bg);
      color: var(--success);
      box-shadow: 0 0 8px rgba(16, 185, 129, 0.1);
    }

    .score-mid {
      background: var(--warning-bg);
      color: var(--warning);
      box-shadow: 0 0 8px rgba(245, 158, 11, 0.1);
    }

    .score-low {
      background: var(--danger-bg);
      color: var(--danger);
      box-shadow: 0 0 8px rgba(239, 68, 68, 0.1);
    }

    /* --- Status Badge --- */
    .status-badge {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 6px;
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .status-active {
      background: var(--success-bg);
      color: var(--success);
    }

    .status-suspended {
      background: var(--warning-bg);
      color: var(--warning);
    }

    .status-banned {
      background: var(--danger-bg);
      color: var(--danger);
    }

    /* --- Action Feed --- */
    .action-feed {
      max-height: 400px;
      overflow-y: auto;
    }

    .action-item {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 14px 12px;
      border-bottom: 1px solid rgba(42, 47, 62, 0.4);
      border-left: 3px solid transparent;
      transition: all var(--transition-base);
      border-radius: 0 6px 6px 0;
    }

    .action-item:hover {
      background: rgba(59, 130, 246, 0.04);
      border-left-color: var(--primary);
    }

    .action-item:last-child {
      border-bottom: none;
    }

    .action-icon {
      width: 34px;
      height: 34px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      flex-shrink: 0;
      font-weight: 700;
      transition: transform var(--transition-base);
    }

    .action-item:hover .action-icon {
      transform: scale(1.05);
    }

    .action-icon.allowed {
      background: var(--success-bg);
    }

    .action-icon.denied {
      background: var(--danger-bg);
    }

    .action-details {
      flex: 1;
      min-width: 0;
    }

    .action-title {
      font-size: 13px;
      font-weight: 500;
    }

    .action-meta {
      font-size: 11px;
      color: var(--text-dim);
      margin-top: 2px;
    }

    .action-time {
      font-size: 11px;
      color: var(--text-dim);
      white-space: nowrap;
    }

    /* --- Chart Container --- */
    .chart-container {
      position: relative;
      height: 220px;
    }

    .bar-chart {
      display: flex;
      align-items: flex-end;
      gap: 3px;
      height: 170px;
      padding-bottom: 28px;
      position: relative;
      border-left: 1px solid rgba(42, 47, 62, 0.5);
      border-bottom: 1px solid rgba(42, 47, 62, 0.5);
    }

    .chart-gridlines {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 28px;
      pointer-events: none;
    }

    .chart-gridline {
      position: absolute;
      left: 0;
      right: 0;
      height: 1px;
      background: rgba(42, 47, 62, 0.3);
    }

    .chart-gridline-label {
      position: absolute;
      left: -4px;
      font-size: 8px;
      color: var(--text-dim);
      transform: translate(-100%, -50%);
      padding-right: 4px;
    }

    .bar-group {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      position: relative;
    }

    .bar {
      width: 100%;
      max-width: 40px;
      border-radius: 6px 6px 0 0;
      transition: height 0.6s cubic-bezier(0.4, 0, 0.2, 1), filter 0.2s;
      min-height: 2px;
      cursor: pointer;
    }

    .bar:hover {
      filter: brightness(1.2);
    }

    .bar.allowed {
      background: linear-gradient(180deg, #34d399, #10b981);
    }

    .bar.denied {
      background: linear-gradient(180deg, #f87171, #ef4444);
    }

    .bar-label {
      font-size: 9px;
      color: var(--text-dim);
      position: absolute;
      bottom: 0;
      transform: translateY(100%);
      white-space: nowrap;
    }

    .bar-tooltip {
      position: absolute;
      bottom: calc(100% + 4px);
      left: 50%;
      transform: translateX(-50%);
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 4px 8px;
      font-size: 11px;
      white-space: nowrap;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.2s;
      z-index: 10;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .bar-group:hover .bar-tooltip {
      opacity: 1;
    }

    /* --- Reputation Distribution --- */
    .distribution-bars {
      display: flex;
      gap: 6px;
      align-items: flex-end;
      height: 120px;
      padding: 0 8px;
    }

    .dist-bar-wrapper {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      height: 100%;
      justify-content: flex-end;
    }

    .dist-bar {
      width: 100%;
      border-radius: 6px 6px 0 0;
      transition: height 0.6s cubic-bezier(0.4, 0, 0.2, 1), filter 0.2s;
      min-height: 2px;
      cursor: pointer;
    }

    .dist-bar:hover {
      filter: brightness(1.25);
    }

    .dist-label {
      font-size: 9px;
      color: var(--text-dim);
      white-space: nowrap;
    }

    .dist-count {
      font-size: 10px;
      font-weight: 700;
      color: var(--text);
      opacity: 0;
      transition: opacity 0.2s;
    }

    .dist-bar-wrapper:hover .dist-count {
      opacity: 1;
    }

    /* --- Gateway Cards --- */
    .gateway-item {
      padding: 14px 0;
      border-bottom: 1px solid var(--border);
    }

    .gateway-item:last-child {
      border-bottom: none;
    }

    .gateway-name {
      font-weight: 700;
      font-size: 14px;
      margin-bottom: 8px;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .gateway-stats {
      display: flex;
      gap: 16px;
      font-size: 12px;
      color: var(--text-dim);
    }

    .gateway-stat-value {
      color: var(--text);
      font-weight: 600;
    }

    /* --- Certificate Feed --- */
    .cert-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 8px;
      border-bottom: 1px solid rgba(42, 47, 62, 0.4);
      font-size: 13px;
      border-radius: 6px;
      transition: background var(--transition-base);
    }

    .cert-item:hover {
      background: rgba(255, 255, 255, 0.02);
    }

    .cert-item:last-child {
      border-bottom: none;
    }

    .cert-agent {
      font-weight: 500;
    }

    .cert-jti {
      font-family: monospace;
      font-size: 11px;
      color: var(--text-dim);
    }

    .cert-status {
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 4px;
    }

    .cert-valid {
      background: var(--success-bg);
      color: var(--success);
    }

    .cert-expired {
      background: var(--warning-bg);
      color: var(--warning);
    }

    .cert-revoked {
      background: var(--danger-bg);
      color: var(--danger);
    }

    /* --- Empty State --- */
    .empty-state {
      text-align: center;
      padding: 48px 24px;
      color: var(--text-dim);
    }

    .empty-state .icon {
      font-size: 40px;
      margin-bottom: 16px;
      display: inline-block;
      opacity: 0.6;
      filter: grayscale(30%);
    }

    .empty-state p {
      font-size: 13px;
      max-width: 280px;
      margin: 0 auto;
      line-height: 1.6;
    }

    /* --- Loading & Skeleton --- */
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px;
      color: var(--text-dim);
    }

    .spinner {
      width: 24px;
      height: 24px;
      border: 3px solid var(--border);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-right: 12px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .skeleton-loading {
      padding: 20px;
    }

    .skeleton {
      background: linear-gradient(90deg, var(--border) 25%, rgba(42, 47, 62, 0.8) 50%, var(--border) 75%);
      background-size: 200% 100%;
      animation: skeleton-shimmer 1.5s ease-in-out infinite;
      border-radius: 6px;
    }

    @keyframes skeleton-shimmer {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    .skeleton-line {
      height: 12px;
      margin-bottom: 12px;
      border-radius: 6px;
    }

    .skeleton-line:last-child {
      margin-bottom: 0;
      width: 60%;
    }

    /* --- Refresh Button --- */
    .refresh-btn {
      background: rgba(59, 130, 246, 0.08);
      border: 1px solid rgba(59, 130, 246, 0.2);
      color: var(--primary);
      padding: 5px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 500;
      transition: all var(--transition-base);
      letter-spacing: 0.2px;
    }

    .refresh-btn:hover {
      background: rgba(59, 130, 246, 0.15);
      border-color: var(--primary);
      box-shadow: 0 0 12px rgba(59, 130, 246, 0.15);
      transform: translateY(-1px);
    }

    .refresh-btn:active {
      transform: translateY(0);
    }

    /* --- Footer --- */
    .dashboard-footer {
      text-align: center;
      padding: 32px;
      margin-top: 16px;
      border-top: 1px solid var(--bg-glass-border);
      color: var(--text-dim);
      font-size: 12px;
    }

    .dashboard-footer a {
      color: var(--primary);
      text-decoration: none;
      transition: color var(--transition-base);
    }

    .dashboard-footer a:hover {
      color: var(--text);
    }

    .footer-links {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 8px;
    }

    .footer-divider {
      width: 40px;
      height: 1px;
      background: var(--border);
      margin: 0 auto 12px;
    }

    /* --- Responsive --- */
    @media (max-width: 1200px) {
      .stats-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    @media (max-width: 968px) {
      .dashboard { padding: 16px; }
      .topbar { padding: 12px 16px; }
      .stats-grid { grid-template-columns: repeat(2, 1fr); }
      .main-grid { grid-template-columns: 1fr; }
      .dashboard-header h1 { font-size: 22px; }
    }

    @media (max-width: 480px) {
      .stats-grid { grid-template-columns: 1fr; }
      .topbar-badge { display: none; }
      .stat-value { font-size: 28px; }
      .dashboard { padding: 12px; }
    }

    /* --- Scrollbar --- */
    ::-webkit-scrollbar { width: 5px; height: 5px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: rgba(42, 47, 62, 0.6); border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--text-dim); }
    * { scrollbar-width: thin; scrollbar-color: rgba(42, 47, 62, 0.6) transparent; }

    /* --- Accessibility --- */
    .refresh-btn:focus-visible,
    .topbar-link:focus-visible {
      outline: 2px solid var(--primary);
      outline-offset: 2px;
    }
  </style>
</head>
<body>
  <!-- Top Bar -->
  <div class="topbar">
    <div class="topbar-left">
      <a href="/" class="topbar-logo">AgentTrust</a>
      <span class="topbar-badge">Dashboard</span>
    </div>
    <div class="topbar-right">
      <div class="live-indicator">
        <div class="live-dot"></div>
        <span>Live</span>
      </div>
      <span id="last-updated" style="font-size: 12px; color: var(--text-dim);">Updating...</span>
      <a href="/docs" class="topbar-link">API Docs</a>
      <a href="https://github.com/mmsadek96/agentgateway" class="topbar-link" target="_blank">GitHub</a>
    </div>
  </div>

  <!-- Dashboard Content -->
  <div class="dashboard">
    <div class="dashboard-header">
      <h1>Station Monitor</h1>
      <p>Real-time overview of all agents, certificates, and gateway activity across the AgentTrust network.</p>
    </div>

    <!-- Stat Cards -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-label">Total Developers</div>
        <div class="stat-value primary" id="stat-developers">-</div>
        <div class="stat-sub">registered accounts</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Active Agents</div>
        <div class="stat-value success" id="stat-agents">-</div>
        <div class="stat-sub" id="stat-agents-sub">-</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Total Actions</div>
        <div class="stat-value warning" id="stat-actions">-</div>
        <div class="stat-sub" id="stat-actions-sub">-</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Certificates Issued</div>
        <div class="stat-value purple" id="stat-certs">-</div>
        <div class="stat-sub">total certificates</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Gateway Reports</div>
        <div class="stat-value primary" id="stat-reports">-</div>
        <div class="stat-sub">behavior reports</div>
      </div>
    </div>

    <!-- Main Grid -->
    <div class="main-grid">

      <!-- Activity Timeline -->
      <div class="card">
        <div class="card-header">
          <span class="card-title">Activity (Last 24h)</span>
          <button class="refresh-btn" onclick="loadTimeline()">Refresh</button>
        </div>
        <div class="card-body">
          <div id="timeline-chart" class="chart-container">
            <div class="skeleton-loading">
              <div style="display:flex;align-items:flex-end;gap:6px;height:160px;">
                <div class="skeleton" style="flex:1;height:40%;"></div>
                <div class="skeleton" style="flex:1;height:65%;"></div>
                <div class="skeleton" style="flex:1;height:30%;"></div>
                <div class="skeleton" style="flex:1;height:80%;"></div>
                <div class="skeleton" style="flex:1;height:55%;"></div>
                <div class="skeleton" style="flex:1;height:45%;"></div>
                <div class="skeleton" style="flex:1;height:70%;"></div>
                <div class="skeleton" style="flex:1;height:35%;"></div>
              </div>
            </div>
          </div>
          <div style="display: flex; gap: 16px; margin-top: 12px; font-size: 12px; color: var(--text-dim);">
            <span><span style="display:inline-block;width:10px;height:10px;background:linear-gradient(180deg, #34d399, #10b981);border-radius:3px;margin-right:4px;vertical-align:middle;"></span>Allowed</span>
            <span><span style="display:inline-block;width:10px;height:10px;background:linear-gradient(180deg, #f87171, #ef4444);border-radius:3px;margin-right:4px;vertical-align:middle;"></span>Denied</span>
          </div>
        </div>
      </div>

      <!-- Reputation Distribution -->
      <div class="card">
        <div class="card-header">
          <span class="card-title">Reputation Distribution</span>
          <span id="avg-score" style="font-size: 12px; color: var(--text-dim);">Avg: -</span>
        </div>
        <div class="card-body">
          <div id="distribution-chart">
            <div class="skeleton-loading">
              <div style="display:flex;align-items:flex-end;gap:8px;height:120px;">
                <div class="skeleton" style="flex:1;height:20%;"></div>
                <div class="skeleton" style="flex:1;height:35%;"></div>
                <div class="skeleton" style="flex:1;height:50%;"></div>
                <div class="skeleton" style="flex:1;height:75%;"></div>
                <div class="skeleton" style="flex:1;height:90%;"></div>
                <div class="skeleton" style="flex:1;height:60%;"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Agent Table -->
      <div class="card full-width">
        <div class="card-header">
          <span class="card-title">All Agents</span>
          <button class="refresh-btn" onclick="loadAgents()">Refresh</button>
        </div>
        <div class="card-body" style="padding: 0;">
          <div style="overflow-x: auto;">
            <table class="agent-table">
              <thead>
                <tr>
                  <th>Agent</th>
                  <th>Developer</th>
                  <th>Status</th>
                  <th>Score</th>
                  <th>Actions</th>
                  <th>Success Rate</th>
                  <th>Stake</th>
                  <th>Vouches</th>
                  <th>Verified</th>
                </tr>
              </thead>
              <tbody id="agents-tbody">
                <tr><td colspan="9">
                  <div class="skeleton-loading">
                    <div class="skeleton skeleton-line" style="width:100%"></div>
                    <div class="skeleton skeleton-line" style="width:90%"></div>
                    <div class="skeleton skeleton-line" style="width:85%"></div>
                    <div class="skeleton skeleton-line" style="width:70%"></div>
                  </div>
                </td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Recent Actions Feed -->
      <div class="card">
        <div class="card-header">
          <span class="card-title">Recent Actions</span>
          <button class="refresh-btn" onclick="loadActions()">Refresh</button>
        </div>
        <div class="card-body">
          <div id="actions-feed" class="action-feed">
            <div class="skeleton-loading">
              <div class="skeleton skeleton-line" style="width:100%"></div>
              <div class="skeleton skeleton-line" style="width:80%"></div>
              <div class="skeleton skeleton-line" style="width:95%"></div>
              <div class="skeleton skeleton-line" style="width:65%"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Certificates -->
      <div class="card">
        <div class="card-header">
          <span class="card-title">Recent Certificates</span>
          <button class="refresh-btn" onclick="loadCertificates()">Refresh</button>
        </div>
        <div class="card-body">
          <div id="certs-feed">
            <div class="skeleton-loading">
              <div class="skeleton skeleton-line" style="width:100%"></div>
              <div class="skeleton skeleton-line" style="width:75%"></div>
              <div class="skeleton skeleton-line" style="width:90%"></div>
              <div class="skeleton skeleton-line" style="width:60%"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Connected Gateways -->
      <div class="card full-width">
        <div class="card-header">
          <span class="card-title">Connected Gateways</span>
          <button class="refresh-btn" onclick="loadGateways()">Refresh</button>
        </div>
        <div class="card-body">
          <div id="gateways-feed">
            <div class="skeleton-loading">
              <div class="skeleton skeleton-line" style="width:100%"></div>
              <div class="skeleton skeleton-line" style="width:85%"></div>
              <div class="skeleton skeleton-line" style="width:70%"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="dashboard-footer">
    <div class="footer-divider"></div>
    <div class="footer-links">
      <a href="https://github.com/mmsadek96/agentgateway" target="_blank">GitHub</a>
      <a href="/docs">API Docs</a>
      <a href="https://www.npmjs.com/org/agent-trust" target="_blank">NPM</a>
    </div>
    <p>AgentTrust &mdash; Open-source trust protocol for AI agents</p>
  </footer>

  <script>
    const BASE = '/dashboard/api';

    // --- Helper Functions ---

    function formatNumber(n) {
      if (n >= 1000000) return (n / 1000000).toFixed(1) + 'M';
      if (n >= 1000) return (n / 1000).toFixed(1) + 'K';
      return n.toString();
    }

    function timeAgo(dateStr) {
      const diff = Date.now() - new Date(dateStr).getTime();
      const mins = Math.floor(diff / 60000);
      if (mins < 1) return 'just now';
      if (mins < 60) return mins + 'm ago';
      const hours = Math.floor(mins / 60);
      if (hours < 24) return hours + 'h ago';
      return Math.floor(hours / 24) + 'd ago';
    }

    function getScoreClass(score) {
      if (score >= 70) return 'score-high';
      if (score >= 40) return 'score-mid';
      return 'score-low';
    }

    function getScoreColor(score) {
      if (score >= 70) return 'var(--success)';
      if (score >= 40) return 'var(--warning)';
      return 'var(--danger)';
    }

    // --- Count-Up Animation ---

    function animateValue(element, start, end, duration) {
      if (start === end) return;
      const range = end - start;
      const startTime = performance.now();

      function update(currentTime) {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const eased = 1 - Math.pow(1 - progress, 3);
        const current = Math.round(start + range * eased);
        element.textContent = formatNumber(current);
        if (progress < 1) {
          requestAnimationFrame(update);
        }
      }
      requestAnimationFrame(update);
    }

    // --- Load Overview Stats ---

    async function loadOverview() {
      try {
        const res = await fetch(BASE + '/overview');
        const { data } = await res.json();

        const devEl = document.getElementById('stat-developers');
        const prevDev = parseInt(devEl.textContent.replace(/[^0-9]/g, '')) || 0;
        animateValue(devEl, prevDev, data.developers, 800);

        const agentEl = document.getElementById('stat-agents');
        const prevAgent = parseInt(agentEl.textContent.replace(/[^0-9]/g, '')) || 0;
        animateValue(agentEl, prevAgent, data.agents.active, 800);
        document.getElementById('stat-agents-sub').textContent =
          `${data.agents.total} total / ${data.agents.suspended} suspended / ${data.agents.banned} banned`;

        const actionEl = document.getElementById('stat-actions');
        const prevAction = parseInt(actionEl.textContent.replace(/[^0-9]/g, '')) || 0;
        animateValue(actionEl, prevAction, data.actions.total, 800);
        document.getElementById('stat-actions-sub').textContent = `${data.actions.last24h} in last 24h`;

        const certEl = document.getElementById('stat-certs');
        const prevCert = parseInt(certEl.textContent.replace(/[^0-9]/g, '')) || 0;
        animateValue(certEl, prevCert, data.certificates, 800);

        const reportEl = document.getElementById('stat-reports');
        const prevReport = parseInt(reportEl.textContent.replace(/[^0-9]/g, '')) || 0;
        animateValue(reportEl, prevReport, data.gatewayReports, 800);

        document.getElementById('last-updated').textContent = 'Updated ' + new Date().toLocaleTimeString();
      } catch (e) {
        console.error('Failed to load overview:', e);
      }
    }

    // --- Load Agents Table ---

    async function loadAgents() {
      try {
        const res = await fetch(BASE + '/agents?sort=reputationScore&order=desc');
        const { data } = await res.json();
        const tbody = document.getElementById('agents-tbody');

        if (data.length === 0) {
          tbody.innerHTML = `<tr><td colspan="9">
            <div class="empty-state">
              <div class="icon">&#x1F916;</div>
              <p>No agents registered yet. Register your first agent via the API.</p>
            </div>
          </td></tr>`;
          return;
        }

        tbody.innerHTML = data.map(agent => `
          <tr>
            <td>
              <div style="display:flex;align-items:center;gap:10px;">
                <div style="width:32px;height:32px;border-radius:8px;background:${getScoreColor(agent.reputationScore)}20;color:${getScoreColor(agent.reputationScore)};display:flex;align-items:center;justify-content:center;font-weight:700;font-size:12px;flex-shrink:0;">
                  ${agent.externalId.substring(0, 2).toUpperCase()}
                </div>
                <div>
                  <div style="font-weight: 600; font-size: 13px;">${agent.externalId}</div>
                  <div style="font-size: 11px; color: var(--text-dim); font-family: monospace;">${agent.id.substring(0, 8)}...</div>
                </div>
              </div>
            </td>
            <td style="color: var(--text-dim); font-size: 13px;">${agent.developer}</td>
            <td><span class="status-badge status-${agent.status}">${agent.status}</span></td>
            <td><span class="score-badge ${getScoreClass(agent.reputationScore)}">${agent.reputationScore}</span></td>
            <td style="font-size: 13px;">${agent.totalActions}</td>
            <td>
              <div style="display: flex; align-items: center; gap: 6px;">
                <div style="flex: 1; height: 4px; background: var(--border); border-radius: 2px; max-width: 60px;">
                  <div style="height: 100%; width: ${agent.successRate}%; background: ${agent.successRate >= 80 ? 'var(--success)' : agent.successRate >= 50 ? 'var(--warning)' : 'var(--danger)'}; border-radius: 2px; transition: width 0.6s;"></div>
                </div>
                <span style="font-size: 12px; color: var(--text-dim);">${agent.successRate}%</span>
              </div>
            </td>
            <td style="font-size: 13px; color: ${agent.stakeAmount > 0 ? 'var(--success)' : 'var(--text-dim)'}">
              ${agent.stakeAmount > 0 ? '$' + agent.stakeAmount.toFixed(2) : '-'}
            </td>
            <td style="font-size: 13px;">${agent.vouchesReceived}</td>
            <td>${agent.identityVerified ? '<span style="color: var(--success);">&#x2713; Yes</span>' : '<span style="color: var(--text-dim);">No</span>'}</td>
          </tr>
        `).join('');
      } catch (e) {
        console.error('Failed to load agents:', e);
        document.getElementById('agents-tbody').innerHTML =
          `<tr><td colspan="9" style="text-align: center; color: var(--danger); padding: 20px;">Failed to load agents</td></tr>`;
      }
    }

    // --- Load Recent Actions Feed ---

    async function loadActions() {
      try {
        const res = await fetch(BASE + '/actions/recent?limit=20');
        const { data } = await res.json();
        const feed = document.getElementById('actions-feed');

        if (data.length === 0) {
          feed.innerHTML = `<div class="empty-state"><div class="icon">&#x1F4CB;</div><p>No actions recorded yet.</p></div>`;
          return;
        }

        feed.innerHTML = data.map(a => `
          <div class="action-item">
            <div class="action-icon ${a.decision}">
              ${a.decision === 'allowed' ? '&#x2713;' : '&#x2717;'}
            </div>
            <div class="action-details">
              <div class="action-title">
                <span style="color: var(--primary);">${a.agentExternalId}</span> &rarr;
                <code style="background: var(--bg); padding: 1px 6px; border-radius: 3px; font-size: 12px;">${a.actionType}</code>
              </div>
              <div class="action-meta">
                ${a.decision === 'allowed' ? 'Allowed' : 'Denied'} &mdash; Score: ${a.agentScore} &mdash; ${a.reason}
              </div>
            </div>
            <div class="action-time">${timeAgo(a.createdAt)}</div>
          </div>
        `).join('');
      } catch (e) {
        console.error('Failed to load actions:', e);
        document.getElementById('actions-feed').innerHTML =
          `<div style="text-align: center; color: var(--danger); padding: 20px;">Failed to load actions</div>`;
      }
    }

    // --- Load Activity Timeline ---

    async function loadTimeline() {
      try {
        const res = await fetch(BASE + '/activity/timeline');
        const { data } = await res.json();
        const container = document.getElementById('timeline-chart');

        const maxTotal = Math.max(...data.map(d => d.total), 1);

        if (data.every(d => d.total === 0)) {
          container.innerHTML = `<div class="empty-state"><div class="icon">&#x1F4CA;</div><p>No activity in the last 24 hours.</p></div>`;
          return;
        }

        container.innerHTML = `
          <div style="position:relative;">
            <div class="chart-gridlines">
              ${[0.25, 0.5, 0.75, 1].map(pct => `
                <div class="chart-gridline" style="bottom:${pct * 100}%;">
                  <span class="chart-gridline-label">${Math.round(maxTotal * pct)}</span>
                </div>
              `).join('')}
            </div>
            <div class="bar-chart">
              ${data.map(d => {
                const allowedH = Math.max((d.allowed / maxTotal) * 150, d.allowed > 0 ? 4 : 0);
                const deniedH = Math.max((d.denied / maxTotal) * 150, d.denied > 0 ? 4 : 0);
                const hour = d.hour.substring(11, 13) + ':00';
                return `
                  <div class="bar-group">
                    <div class="bar-tooltip">${d.allowed} allowed / ${d.denied} denied</div>
                    <div class="bar denied" style="height: ${deniedH}px;" title="${d.denied} denied"></div>
                    <div class="bar allowed" style="height: ${allowedH}px;" title="${d.allowed} allowed"></div>
                    <div class="bar-label">${hour}</div>
                  </div>
                `;
              }).join('')}
            </div>
          </div>
        `;
      } catch (e) {
        console.error('Failed to load timeline:', e);
        document.getElementById('timeline-chart').innerHTML =
          `<div style="text-align: center; color: var(--danger); padding: 20px;">Failed to load timeline</div>`;
      }
    }

    // --- Load Reputation Distribution ---

    async function loadDistribution() {
      try {
        const res = await fetch(BASE + '/reputation/distribution');
        const { data } = await res.json();
        const container = document.getElementById('distribution-chart');

        document.getElementById('avg-score').textContent = `Avg: ${data.averageScore}`;

        const dist = data.distribution;
        const maxCount = Math.max(...Object.values(dist), 1);

        if (data.totalAgents === 0) {
          container.innerHTML = `<div class="empty-state"><div class="icon">&#x1F4C8;</div><p>No agents to show distribution.</p></div>`;
          return;
        }

        const colors = [
          'var(--danger)', 'var(--danger)', '#f97316', 'var(--warning)', 'var(--warning)',
          '#84cc16', 'var(--success)', 'var(--success)', 'var(--primary)', 'var(--purple)'
        ];

        container.innerHTML = `
          <div class="distribution-bars">
            ${Object.entries(dist).map(([range, count], i) => {
              const h = Math.max((count / maxCount) * 100, count > 0 ? 6 : 2);
              return `
                <div class="dist-bar-wrapper">
                  <div class="dist-count">${count}</div>
                  <div class="dist-bar" style="height: ${h}px; background: ${colors[i]};"></div>
                  <div class="dist-label">${range}</div>
                </div>
              `;
            }).join('')}
          </div>
        `;
      } catch (e) {
        console.error('Failed to load distribution:', e);
      }
    }

    // --- Load Certificates ---

    async function loadCertificates() {
      try {
        const res = await fetch(BASE + '/certificates/recent?limit=10');
        const { data } = await res.json();
        const container = document.getElementById('certs-feed');

        if (data.length === 0) {
          container.innerHTML = `<div class="empty-state"><div class="icon">&#x1F510;</div><p>No certificates issued yet.</p></div>`;
          return;
        }

        container.innerHTML = data.map(c => {
          let statusClass = 'cert-valid';
          let statusText = 'Valid';
          if (c.revoked) { statusClass = 'cert-revoked'; statusText = 'Revoked'; }
          else if (c.expired) { statusClass = 'cert-expired'; statusText = 'Expired'; }

          return `
            <div class="cert-item">
              <div>
                <div class="cert-agent">${c.agentExternalId}</div>
                <div class="cert-jti">${c.jti.substring(0, 12)}...</div>
              </div>
              <div style="text-align: center;">
                <span class="score-badge ${getScoreClass(c.scoreAtIssuance)}" style="font-size: 11px;">${c.scoreAtIssuance}</span>
              </div>
              <div style="text-align: right;">
                <span class="cert-status ${statusClass}">${statusText}</span>
                <div style="font-size: 10px; color: var(--text-dim); margin-top: 2px;">${timeAgo(c.issuedAt)}</div>
              </div>
            </div>
          `;
        }).join('');
      } catch (e) {
        console.error('Failed to load certificates:', e);
      }
    }

    // --- Load Gateways ---

    async function loadGateways() {
      try {
        const res = await fetch(BASE + '/gateways');
        const { data } = await res.json();
        const container = document.getElementById('gateways-feed');

        if (data.length === 0) {
          container.innerHTML = `<div class="empty-state"><div class="icon">&#x1F310;</div><p>No gateways have reported yet. Install @agent-trust/gateway on a website to see data here.</p></div>`;
          return;
        }

        container.innerHTML = `
          <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px;">
            ${data.map(g => `
              <div style="background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; padding: 18px; transition: all 0.25s; position: relative; overflow: hidden;">
                <div style="position:absolute;top:0;left:0;right:0;height:2px;background:var(--gradient-primary);"></div>
                <div class="gateway-name">${g.gatewayId}</div>
                <div class="gateway-stats" style="flex-wrap: wrap;">
                  <span>Reports: <span class="gateway-stat-value">${g.totalReports}</span></span>
                  <span>Actions: <span class="gateway-stat-value">${g.totalActions}</span></span>
                  <span>Success: <span class="gateway-stat-value" style="color: var(--success);">${g.successRate}%</span></span>
                </div>
                <div style="font-size: 11px; color: var(--text-dim); margin-top: 8px;">Last report: ${timeAgo(g.lastReport)}</div>
              </div>
            `).join('')}
          </div>
        `;
      } catch (e) {
        console.error('Failed to load gateways:', e);
      }
    }

    // --- Initialize & Auto-Refresh ---

    async function loadAll() {
      await Promise.all([
        loadOverview(),
        loadAgents(),
        loadActions(),
        loadTimeline(),
        loadDistribution(),
        loadCertificates(),
        loadGateways()
      ]);
    }

    // Initial load
    loadAll();

    // Auto-refresh every 30 seconds
    setInterval(loadAll, 30000);
  </script>
</body>
</html>
